{"version":3,"names":[],"mappings":"","sources":["layout-builder.js"],"sourcesContent":["//== Class definition\r\nvar LayoutBuilder = function() {\r\n\r\n\tvar exporter = {\r\n\t\tinit: function() {\r\n\t\t\t$('#m-btn-howto').click(function(e) {\r\n\t\t\t\te.preventDefault();\r\n\t\t\t\t$('#m-howto').slideToggle();\r\n\t\t\t});\r\n\t\t\tthis.exportHtml();\r\n\t\t\tthis.exportHtmlStatic();\r\n\t\t\tthis.exportAngular();\r\n\t\t},\r\n\t\tstartLoad: function(options) {\r\n\t\t\t$('#builder_export').\r\n\t\t\t\taddClass('m-loader m-loader--light m-loader--right').\r\n\t\t\t\tfind('> span > span').\r\n\t\t\t\ttext('Exporting...').\r\n\t\t\t\tclosest('.m-form__actions').\r\n\t\t\t\tfind('.btn').\r\n\t\t\t\tprop('disabled', true);\r\n\t\t\t$.notify(options);\r\n\t\t},\r\n\t\tdoneLoad: function() {\r\n\t\t\t$('#builder_export').\r\n\t\t\t\tremoveClass('m-loader m-loader--light m-loader--right').\r\n\t\t\t\tfind('> span > span').\r\n\t\t\t\ttext('Export').\r\n\t\t\t\tclosest('.m-form__actions').\r\n\t\t\t\tfind('.btn').\r\n\t\t\t\tprop('disabled', false);\r\n\t\t},\r\n\t\texportHtml: function() {\r\n\t\t\t$('#builder_export_html').click(function(e) {\r\n\t\t\t\te.preventDefault();\r\n\t\t\t\tif (!envato.isVerified()) return;\r\n\r\n\t\t\t\tvar _self = $(this);\r\n\r\n\t\t\t\texporter.startLoad({\r\n\t\t\t\t\ttitle: 'Generate HTML Partials',\r\n\t\t\t\t\tmessage: 'Process started and it may take about 1 to 10 minutes.',\r\n\t\t\t\t});\r\n\r\n\t\t\t\t$.ajax('index.php', {\r\n\t\t\t\t\tmethod: 'POST',\r\n\t\t\t\t\tdata: {\r\n\t\t\t\t\t\tbuilder_export: 1,\r\n\t\t\t\t\t\texport_type: 'partial',\r\n\t\t\t\t\t\tdemo: $(_self).data('demo'),\r\n\t\t\t\t\t},\r\n\t\t\t\t}).done(function(r) {\r\n\t\t\t\t\tvar result = JSON.parse(r);\r\n\t\t\t\t\tif (result.message) {\r\n\t\t\t\t\t\texporter.stopWithNotify(result.message);\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tvar timer = setInterval(function() {\r\n\t\t\t\t\t\t$.ajax('index.php', {\r\n\t\t\t\t\t\t\tmethod: 'POST',\r\n\t\t\t\t\t\t\tdata: {\r\n\t\t\t\t\t\t\t\tbuilder_export: 1,\r\n\t\t\t\t\t\t\t\tbuilder_check: result.id,\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t}).done(function(r) {\r\n\t\t\t\t\t\t\tvar result = JSON.parse(r);\r\n\t\t\t\t\t\t\tif (typeof result === 'undefined') return;\r\n\t\t\t\t\t\t\t// export status 1 is completed\r\n\t\t\t\t\t\t\tif (result.export_status !== 1) return;\r\n\r\n\t\t\t\t\t\t\t$('<iframe/>').attr({\r\n\t\t\t\t\t\t\t\tsrc: 'index.php?builder_export&builder_download&id=' +\r\n\t\t\t\t\t\t\t\tresult.id,\r\n\t\t\t\t\t\t\t\tstyle: 'visibility:hidden;display:none',\r\n\t\t\t\t\t\t\t}).ready(function() {\r\n\t\t\t\t\t\t\t\t$.notify({\r\n\t\t\t\t\t\t\t\t\ttitle: 'Export HTML Version Layout',\r\n\t\t\t\t\t\t\t\t\tmessage: 'HTML version exported.',\r\n\t\t\t\t\t\t\t\t}, {type: 'success'});\r\n\t\t\t\t\t\t\t\texporter.doneLoad();\r\n\t\t\t\t\t\t\t\t// stop the timer\r\n\t\t\t\t\t\t\t\tclearInterval(timer);\r\n\t\t\t\t\t\t\t}).appendTo(_self);\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}, 15000);\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t},\r\n\t\texportHtmlStatic: function() {\r\n\t\t\t$('#builder_export_html_static').click(function(e) {\r\n\t\t\t\te.preventDefault();\r\n\t\t\t\tif (!envato.isVerified()) return;\r\n\r\n\t\t\t\tvar _self = $(this);\r\n\r\n\t\t\t\texporter.startLoad({\r\n\t\t\t\t\ttitle: 'Generate HTML Static Version',\r\n\t\t\t\t\tmessage: 'Process started and it may take about 1 to 10 minutes.',\r\n\t\t\t\t});\r\n\r\n\t\t\t\t$.ajax('index.php', {\r\n\t\t\t\t\tmethod: 'POST',\r\n\t\t\t\t\tdata: {\r\n\t\t\t\t\t\tbuilder_export: 1,\r\n\t\t\t\t\t\texport_type: 'html',\r\n\t\t\t\t\t\tdemo: $(_self).data('demo'),\r\n\t\t\t\t\t},\r\n\t\t\t\t}).done(function(r) {\r\n\t\t\t\t\tvar result = JSON.parse(r);\r\n\t\t\t\t\tif (result.message) {\r\n\t\t\t\t\t\texporter.stopWithNotify(result.message);\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tvar timer = setInterval(function() {\r\n\t\t\t\t\t\t$.ajax('index.php', {\r\n\t\t\t\t\t\t\tmethod: 'POST',\r\n\t\t\t\t\t\t\tdata: {\r\n\t\t\t\t\t\t\t\tbuilder_export: 1,\r\n\t\t\t\t\t\t\t\tbuilder_check: result.id,\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t}).done(function(r) {\r\n\t\t\t\t\t\t\tvar result = JSON.parse(r);\r\n\t\t\t\t\t\t\tif (typeof result === 'undefined') return;\r\n\t\t\t\t\t\t\t// export status 1 is completed\r\n\t\t\t\t\t\t\tif (result.export_status !== 1) return;\r\n\r\n\t\t\t\t\t\t\t$('<iframe/>').attr({\r\n\t\t\t\t\t\t\t\tsrc: 'index.php?builder_export&builder_download&id=' +\r\n\t\t\t\t\t\t\t\tresult.id,\r\n\t\t\t\t\t\t\t\tstyle: 'visibility:hidden;display:none',\r\n\t\t\t\t\t\t\t}).ready(function() {\r\n\t\t\t\t\t\t\t\t$.notify({\r\n\t\t\t\t\t\t\t\t\ttitle: 'Export Default Version',\r\n\t\t\t\t\t\t\t\t\tmessage: 'Default HTML version exported with current configured layout.',\r\n\t\t\t\t\t\t\t\t}, {type: 'success'});\r\n\t\t\t\t\t\t\t\texporter.doneLoad();\r\n\t\t\t\t\t\t\t\t// stop the timer\r\n\t\t\t\t\t\t\t\tclearInterval(timer);\r\n\t\t\t\t\t\t\t}).appendTo(_self);\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}, 15000);\r\n\t\t\t\t});\r\n\r\n\t\t\t});\r\n\t\t},\r\n\t\texportAngular: function() {\r\n\t\t\t$('#builder_export_angular').click(function(e) {\r\n\t\t\t\te.preventDefault();\r\n\t\t\t\tif (!envato.isVerified()) return;\r\n\r\n\t\t\t\tvar _self = $(this);\r\n\r\n\t\t\t\texporter.startLoad({\r\n\t\t\t\t\ttitle: 'Export Angular Version',\r\n\t\t\t\t\tmessage: 'Process started and it may take about 1 to 10 minutes.',\r\n\t\t\t\t});\r\n\r\n\t\t\t\t$.ajax('index.php', {\r\n\t\t\t\t\tmethod: 'POST',\r\n\t\t\t\t\tdata: {\r\n\t\t\t\t\t\tbuilder_export: 1,\r\n\t\t\t\t\t\texport_type: 'angular',\r\n\t\t\t\t\t\tdemo: $(_self).data('demo'),\r\n\t\t\t\t\t},\r\n\t\t\t\t}).done(function(r) {\r\n\t\t\t\t\tvar result = JSON.parse(r);\r\n\t\t\t\t\tif (result.message) {\r\n\t\t\t\t\t\texporter.stopWithNotify(result.message);\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tvar timer = setInterval(function() {\r\n\t\t\t\t\t\t$.ajax('index.php', {\r\n\t\t\t\t\t\t\tmethod: 'POST',\r\n\t\t\t\t\t\t\tdata: {\r\n\t\t\t\t\t\t\t\tbuilder_export: 1,\r\n\t\t\t\t\t\t\t\tbuilder_check: result.id,\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t}).done(function(r) {\r\n\t\t\t\t\t\t\tvar result = JSON.parse(r);\r\n\t\t\t\t\t\t\tif (typeof result === 'undefined') return;\r\n\t\t\t\t\t\t\t// export status 1 is completed\r\n\t\t\t\t\t\t\tif (result.export_status !== 1) return;\r\n\r\n\t\t\t\t\t\t\t$('<iframe/>').attr({\r\n\t\t\t\t\t\t\t\tsrc: 'index.php?builder_export&builder_download&id=' +\r\n\t\t\t\t\t\t\t\tresult.id,\r\n\t\t\t\t\t\t\t\tstyle: 'visibility:hidden;display:none',\r\n\t\t\t\t\t\t\t}).ready(function() {\r\n\t\t\t\t\t\t\t\t$.notify({\r\n\t\t\t\t\t\t\t\t\ttitle: 'Export Angular Version',\r\n\t\t\t\t\t\t\t\t\tmessage: 'Angular App version exported with current configured layout.',\r\n\t\t\t\t\t\t\t\t}, {type: 'success'});\r\n\t\t\t\t\t\t\t\texporter.doneLoad();\r\n\t\t\t\t\t\t\t\t// stop the timer\r\n\t\t\t\t\t\t\t\tclearInterval(timer);\r\n\t\t\t\t\t\t\t}).appendTo(_self);\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}, 15000);\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t},\r\n\t\tstopWithNotify: function(message, type) {\r\n\t\t\ttype = type || 'danger';\r\n\t\t\t$.notify({\r\n\t\t\t\ttitle: 'Verification failed',\r\n\t\t\t\tmessage: message,\r\n\t\t\t}, {type: type});\r\n\t\t\texporter.doneLoad();\r\n\t\t},\r\n\t};\r\n\r\n\t//== Private functions\r\n\tvar preview = function() {\r\n\t\t$('[name=\"builder_submit\"]').click(function(e) {\r\n\t\t\te.preventDefault();\r\n\t\t\tvar _self = $(this);\r\n\t\t\t$(_self).\r\n\t\t\t\taddClass('m-loader m-loader--light m-loader--right').\r\n\t\t\t\tclosest('.m-form__actions').\r\n\t\t\t\tfind('.btn').\r\n\t\t\t\tprop('disabled', true);\r\n\r\n\t\t\t$.ajax('index.php?demo=' + $(_self).data('demo'), {\r\n\t\t\t\tmethod: 'POST',\r\n\t\t\t\tdata: $('[name]').serialize(),\r\n\t\t\t}).done(function(r) {\r\n\t\t\t\t$.notify({\r\n\t\t\t\t\ttitle: 'Preview updated',\r\n\t\t\t\t\tmessage: 'Preview has been updated with current configured layout.',\r\n\t\t\t\t}, {type: 'success'});\r\n\t\t\t}).always(function() {\r\n\t\t\t\tsetTimeout(function() {\r\n\t\t\t\t\tlocation.reload();\r\n\t\t\t\t}, 600);\r\n\t\t\t});\r\n\t\t});\r\n\t};\r\n\r\n\tvar reset = function() {\r\n\t\t$('[name=\"builder_reset\"]').click(function(e) {\r\n\t\t\te.preventDefault();\r\n\t\t\tvar _self = $(this);\r\n\t\t\t$(_self).\r\n\t\t\t\taddClass('m-loader m-loader--primary m-loader--right').\r\n\t\t\t\tclosest('.m-form__actions').\r\n\t\t\t\tfind('.btn').\r\n\t\t\t\tprop('disabled', true);\r\n\r\n\t\t\t$.ajax('index.php?demo=' + $(_self).data('demo'), {\r\n\t\t\t\tmethod: 'POST',\r\n\t\t\t\tdata: {\r\n\t\t\t\t\tbuilder_reset: 1,\r\n\t\t\t\t\tdemo: $(_self).data('demo'),\r\n\t\t\t\t},\r\n\t\t\t}).done(function(r) {\r\n\t\t\t}).always(function() {\r\n\t\t\t\tlocation.reload();\r\n\t\t\t});\r\n\t\t});\r\n\t};\r\n\r\n\tvar keepActiveTab = function() {\r\n\t\t$('[href^=\"#m_builder_\"]').click(function(e) {\r\n\t\t\tvar which = $(this).attr('href');\r\n\t\t\tvar btn = $('[name=\"builder_submit\"]');\r\n\t\t\tvar tab = $('[name=\"builder[tab]\"]');\r\n\t\t\tif ($(tab).length === 0) {\r\n\t\t\t\t$('<input/>').\r\n\t\t\t\t\tattr('type', 'hidden').\r\n\t\t\t\t\tattr('name', 'builder[tab]').\r\n\t\t\t\t\tval(which).\r\n\t\t\t\t\tinsertBefore(btn);\r\n\t\t\t} else {\r\n\t\t\t\t$(tab).val(which);\r\n\t\t\t}\r\n\t\t}).each(function() {\r\n\t\t\tif ($(this).hasClass('active')) {\r\n\t\t\t\tvar which = $(this).attr('href');\r\n\t\t\t\tvar btn = $('[name=\"builder_submit\"]');\r\n\t\t\t\tvar tab = $('[name=\"builder[tab]\"]');\r\n\t\t\t\tif ($(tab).length === 0) {\r\n\t\t\t\t\t$('<input/>').\r\n\t\t\t\t\t\tattr('type', 'hidden').\r\n\t\t\t\t\t\tattr('name', 'builder[tab]').\r\n\t\t\t\t\t\tval(which).\r\n\t\t\t\t\t\tinsertBefore(btn);\r\n\t\t\t\t} else {\r\n\t\t\t\t\t$(tab).val(which);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t};\r\n\r\n\t// localStorage.removeItem('envato');\r\n\twindow.envato = {\r\n\t\tapiKey: '05kxpfkxwymzzczjm75d9s3li4spg0j1',\r\n\t\texpires_in: '3600', // seconds\r\n\t\tisVerified: function() {\r\n\t\t\t// console.log(envato.getItem());\r\n\t\t\t// check token is not expired and verified\r\n\t\t\treturn !envato.tokenIsExpired() && envato.getItem('verified');\r\n\t\t},\r\n\t\treCaptchaVerified: function() {\r\n\t\t\treturn $.ajax('https://keenthemes.com/metronic/preview/inc/api/envato.php?recaptcha', {\r\n\t\t\t\tmethod: 'POST',\r\n\t\t\t\tdata: {\r\n\t\t\t\t\tresponse: $('#g-recaptcha-response').val(),\r\n\t\t\t\t},\r\n\t\t\t}).fail(function() {\r\n\t\t\t\tgrecaptcha.reset();\r\n\t\t\t\t$('#alert-message').\r\n\t\t\t\t\tremoveClass('alert-success m--hide').\r\n\t\t\t\t\taddClass('alert-danger').\r\n\t\t\t\t\thtml('Invalid reCaptcha validation');\r\n\t\t\t});\r\n\t\t},\r\n\t\tverifyEvent: function() {\r\n\t\t\t// click event\r\n\t\t\t$('#builder_export').click(function(e) {\r\n\t\t\t\te.preventDefault();\r\n\t\t\t\tif (envato.isVerified()) return;\r\n\t\t\t\tgrecaptcha.reset();\r\n\t\t\t\t$('#m-modal-purchase').modal('show');\r\n\t\t\t\t$('#alert-message').addClass('m--hide');\r\n\t\t\t});\r\n\r\n\t\t\t$('#submit-verify').click(function(e) {\r\n\t\t\t\te.preventDefault();\r\n\t\t\t\tenvato.reCaptchaVerified().done(function(response) {\r\n\t\t\t\t\tif (response.success) {\r\n\t\t\t\t\t\tvar purchaseCode = $('#purchase-code').val();\r\n\t\t\t\t\t\tenvato.setItem('purchase_code', purchaseCode);\r\n\t\t\t\t\t\tenvato.verifyPurchase(purchaseCode);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tgrecaptcha.reset();\r\n\t\t\t\t\t\t$('#alert-message').\r\n\t\t\t\t\t\t\tremoveClass('alert-success m--hide').\r\n\t\t\t\t\t\t\taddClass('alert-danger').\r\n\t\t\t\t\t\t\thtml('Invalid reCaptcha validation');\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t});\r\n\r\n\t\t\t$('#purchase-code').keyup(function() {\r\n\t\t\t\t$('#alert-message').addClass('m--hide');\r\n\t\t\t});\r\n\t\t},\r\n\t\tverifyPurchase: function(purchaseCode) {\r\n\t\t\treturn $.ajax('https://marketplace.envato.com/api/edge/keenthemes/' +\r\n\t\t\t\tenvato.apiKey + '/verify-purchase:' +\r\n\t\t\t\tpurchaseCode + '.json', {\r\n\t\t\t\tmethod: 'GET',\r\n\t\t\t}).done(function(response) {\r\n\t\t\t\tif (!$.isEmptyObject(response['verify-purchase'])) {\r\n\t\t\t\t\tenvato.setItems(response['verify-purchase']);\r\n\t\t\t\t\tenvato.setItem('verified', true);\r\n\r\n\t\t\t\t\t// keep session is php\r\n\t\t\t\t\t$.ajax('inc/api/envato.php', {\r\n\t\t\t\t\t\tmethod: 'POST',\r\n\t\t\t\t\t\tdata: envato.getItem(),\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\t$('#alert-message').\r\n\t\t\t\t\t\tremoveClass('alert-danger m--hide').\r\n\t\t\t\t\t\taddClass('alert-success').\r\n\t\t\t\t\t\thtml('Purchase code is successfully verified');\r\n\t\t\t\t} else {\r\n\t\t\t\t\tgrecaptcha.reset();\r\n\t\t\t\t\t$('#alert-message').\r\n\t\t\t\t\t\tremoveClass('alert-success m--hide').\r\n\t\t\t\t\t\taddClass('alert-danger').\r\n\t\t\t\t\t\thtml('Invalid purchase code');\r\n\t\t\t\t}\r\n\t\t\t}).fail(function(e) {\r\n\t\t\t\tgrecaptcha.reset();\r\n\t\t\t\t$('#alert-message').\r\n\t\t\t\t\tremoveClass('alert-success m--hide').\r\n\t\t\t\t\taddClass('alert-danger').\r\n\t\t\t\t\thtml('Invalid purchase code');\r\n\t\t\t});\r\n\t\t},\r\n\t\tsetItems: function(object) {\r\n\t\t\tvar params = $.extend({}, envato.getItem(), object);\r\n\t\t\tlocalStorage.setItem('envato', JSON.stringify(params));\r\n\t\t},\r\n\t\tsetItem: function(key, val) {\r\n\t\t\tvar assign = {};\r\n\t\t\tassign[key] = val;\r\n\t\t\tvar params = $.extend({}, envato.getItem(), assign);\r\n\t\t\tlocalStorage.setItem('envato', JSON.stringify(params));\r\n\t\t},\r\n\t\tgetItem: function(key) {\r\n\t\t\tvar params = JSON.parse(localStorage.getItem('envato'));\r\n\t\t\tif (typeof key !== 'undefined') {\r\n\t\t\t\treturn params !== null ? params[key] : null;\r\n\t\t\t}\r\n\t\t\treturn params;\r\n\t\t},\r\n\t\tstartTimer: function(now) {\r\n\t\t\tenvato.setItem('created_on', now);\r\n\t\t\tsetTimeout(function() {\r\n\t\t\t\tlocalStorage.removeItem('envato');\r\n\t\t\t}, envato.expires_in * 1000);\r\n\t\t},\r\n\t\ttokenIsExpired: function() {\r\n\t\t\tvar diff = new Date().getTime() - envato.getItem('created_on');\r\n\t\t\tif (typeof envato.expires_in === 'undefined' ||\r\n\t\t\t\tdiff >= (envato.expires_in * 1000)) {\r\n\t\t\t\tlocalStorage.removeItem('envato');\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t\treturn false;\r\n\t\t},\r\n\t};\r\n\r\n\t// basic demo\r\n\tvar init = function() {\r\n\t\texporter.init();\r\n\t\tkeepActiveTab();\r\n\t\tpreview();\r\n\t\treset();\r\n\t};\r\n\r\n\treturn {\r\n\t\t// public functions\r\n\t\tinit: function() {\r\n\t\t\tenvato.verifyEvent();\r\n\t\t\tinit();\r\n\t\t},\r\n\t};\r\n}();\r\n\r\njQuery(document).ready(function() {\r\n\tLayoutBuilder.init();\r\n});"],"file":"layout-builder.js"}